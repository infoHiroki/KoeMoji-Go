# v1.7.2 リリースノート

**リリース日**: 2025-10-25
**バージョン**: 1.7.2

---

## 🎉 概要

v1.7.2 は、Windows版のアイコン埋め込み問題を修正した緊急パッチリリースです。これまでタスクバーにアイコンが表示されなかった問題が解決され、より完成度の高いデスクトップアプリケーション体験を提供します。

---

## 🐛 バグ修正

### Windows版アイコン埋め込み失敗の修正

**問題**: Windows版実行ファイル（koemoji-go.exe）にアイコンが埋め込まれておらず、タスクバーにデフォルトアイコンしか表示されなかった

**症状**:
- タスクバーのアイコンが汎用的な白いアイコンになる
- エクスプローラーでもアイコンが表示されない
- アプリケーションの視認性・ブランディングが低下

**根本原因**:
ビルドスクリプト（build.bat）のgoversioninfo呼び出し時に、出力パス（`%TEMP_DIR%\resource.syso`）が絶対パス形式で指定されており、goversioninfoがそのパスを正しく処理できていなかった

**修正内容**:
- **build/windows/build.bat**:
  - goversioninfoの出力先を絶対パスから相対パス（`resource.syso`）に変更
  - リソースファイルの生成場所を`templates/windows`ディレクトリに変更
  - コピー処理のエラーハンドリングを改善
  - クリーンアップ処理を最適化（不要なtempディレクトリ参照を削除）

**変更箇所**:
```batch
# 変更前（失敗していた）
"%GOPATH_BIN%\goversioninfo.exe" -64 -o "%TEMP_DIR%\resource.syso" versioninfo.json

# 変更後（成功する）
"%GOPATH_BIN%\goversioninfo.exe" -64 -o resource.syso versioninfo.json
```

**検証結果**:
- ✅ ビルドログに `[OK] Icon will be embedded in executable` が表示
- ✅ エラーメッセージなし
- ✅ exeファイルサイズが約220KB増加（24,486,400 → 24,708,608バイト）
  - これはアイコンリソース（20KB）が正しく埋め込まれた証拠

**影響範囲**: Windows版のみ（macOS版は影響なし）

---

## 🔧 改善

### versioninfo.jsonのバージョン更新

**変更内容**:
- バージョン情報を1.6.0から1.7.2に更新
- FileVersion、ProductVersionの両方を統一

**ファイル**: build/common/templates/windows/versioninfo.json

```json
"FileVersion": {
    "Major": 1,
    "Minor": 7,
    "Patch": 2,
    "Build": 0
}
```

---

## 📦 ダウンロード

### Windows 版

**ファイル名**: `koemoji-go-windows-1.7.2.zip`

**内容**:
```
koemoji-go-1.7.2/
├── koemoji-go.exe           # 実行ファイル（アイコン埋め込み済み）
├── libportaudio.dll         # PortAudio ライブラリ
├── libgcc_s_seh-1.dll       # GCC ランタイム
├── libwinpthread-1.dll      # pthread ライブラリ
├── config.json              # 設定ファイル（サンプル）
└── README.md                # リリースノート
```

**インストール手順**:
1. ZIP を解凍
2. `koemoji-go.exe` をダブルクリック
3. 初回起動時に `config.json` を編集

**新機能（v1.7.0からの継続）**:
- デュアル録音機能（システム音声+マイク同時録音）
- FasterWhisper音声認識の改善
- リアルタイム録音の安定性向上

---

## 🔄 アップグレードガイド

### v1.7.0/v1.7.1 から v1.7.2 へ

**データ移行**:

既存の設定ファイル（`config.json`）はそのまま使用可能です。

```bash
# 1. 古いバージョンのディレクトリから config.json をコピー
cp koemoji-go-windows-1.7.1/config.json koemoji-go-1.7.2/

# 2. 処理済みアーカイブもコピー（必要に応じて）
cp -r koemoji-go-windows-1.7.1/archive koemoji-go-1.7.2/
```

**互換性**: v1.7.x と完全に互換性があります

---

## ✅ 修正された問題

| Issue | 説明 | 影響 |
|-------|------|------|
| アイコン埋め込み失敗 | goversioninfoのパス指定問題でアイコンが埋め込まれない | Windows版のみ |
| ビルドログの誤表示 | エラー発生時も`[OK]`と表示されていた | ビルドプロセス |

---

## 🧪 テスト状況

### 修正確認済み

- ✅ goversioninfoの手動実行テスト
- ✅ resource.sysoの生成確認
- ✅ ビルドスクリプトの完全実行
- ✅ exeファイルサイズの増加確認（アイコン埋め込み成功）
- ✅ ビルドログにエラーメッセージなし

### 実機テスト推奨

- ⏳ Windows実機でのタスクバーアイコン表示確認
- ⏳ エクスプローラーでのアイコン表示確認
- ⏳ 各種Windows版（Windows 10/11）での動作確認

---

## 📝 技術詳細

### goversioninfoの動作

goversioninfoは、Goアプリケーション用のWindows リソース埋め込みツールです。

**主な機能**:
- アプリケーションアイコンの埋め込み
- バージョン情報の埋め込み（ファイルプロパティで表示）
- 会社名、著作権情報の設定

**生成されるファイル**:
- `resource.syso`: Windowsリソースオブジェクトファイル
- このファイルがGoビルド時に自動的にリンクされる

**パス指定の問題**:
- 絶対パス（`C:\dev\...`形式）を使用すると、一部環境で失敗
- 相対パス（`resource.syso`）を使用することで環境非依存に

---

## 📝 既知の問題

現時点で既知の問題はありません。

バグを発見された場合は、GitHub Issues でご報告ください：
https://github.com/infoHiroki/KoeMoji-Go/issues

---

## 🔗 関連ドキュメント

- [CLAUDE.md](../../CLAUDE.md)
- [version.go](../../version.go)
- [build.bat](../../build/windows/build.bat)
- [versioninfo.json](../../build/common/templates/windows/versioninfo.json)

---

## 👥 貢献者

- [@infoHiroki](https://github.com/infoHiroki) - 開発
- Claude Code - バグ修正支援、ドキュメント作成

---

## 📄 ライセンス

個人利用自由、商用利用は作者に連絡してください。

---

**次回リリース予定**: v1.8.0（新機能追加予定）

**フィードバック**: [GitHub Issues](https://github.com/infoHiroki/KoeMoji-Go/issues)
