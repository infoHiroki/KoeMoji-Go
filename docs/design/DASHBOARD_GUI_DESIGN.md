# KoeMoji-Go GUI視覚改善設計書

## 設計方針

### 基本理念
既存TUIの優れた情報構造を完全維持し、視覚的な見やすさのみを改善する。

### 設計原則
- **機能変更なし**: 既存のすべての機能・ロジックをそのまま維持
- **構造維持**: 3層構造（ステータス・ログ・ボタン）を変更しない
- **最小限改善**: 必要最小限の視覚的改善のみ実施
- **バグリスク最小化**: 既存コードの変更を極力避ける

## 現在のGUI分析

### 既存の優れた構造
```
┌─────────────────────────────────────┐
│ 🟢 稼働中 | 待機: 0 | 処理中: なし      │  ← 完璧な情報設計
│ 📁 入力: 2 → 出力: 5 → アーカイブ: 10   │  ← 過不足ない表示
│ ⏰ 最終: 15:04:05 | 次回: 15:05:05     │  ← 必要十分な情報
├─────────────────────────────────────┤
│ [INFO] 15:04:05 メッセージ...          │  ← シンプルなログ
│ [PROC] 15:04:10 処理中...             │
│ ...                                 │
├─────────────────────────────────────┤
│ [設定] [ログ] [スキャン] [入力] [終了]   │  ← 必要な機能のみ
└─────────────────────────────────────┘
```

### 既存構造の優秀さ
- **3行ステータス**: システム状態、ファイル数、タイミングを過不足なく表示
- **シンプルログ**: 時系列順の必要情報のみ
- **機能的ボタン**: 実用的な操作のみを配置

## 改善設計

### 改善方針: 「美しく見せる」のみ
既存の情報構造は変更せず、視覚的な改善のみを実施

### 1. ステータスパネル改善

#### 現在
```
🟢 稼働中 | 待機: 0 | 処理中: なし
📁 入力: 2 → 出力: 5 → アーカイブ: 10  
⏰ 最終: 15:04:05 | 次回: 15:05:05 | 稼働: 2h
```

#### 改善後
```go
// 既存の3行構造を維持、カード形式で見やすく
statusCard := widget.NewCard("システム状態", "", container.NewVBox(
    // 行1: システム状態（色付きアイコンで視認性向上）
    widget.NewLabelWithStyle("🟢 稼働中 | 待機: 0 | 処理中: なし", 
        fyne.TextAlignLeading, fyne.TextStyle{Bold: true}),
    
    // 行2: ファイル数（既存表示を維持）
    widget.NewLabel("📁 入力: 2 → 出力: 5 → アーカイブ: 10"),
    
    // 行3: タイミング情報（既存表示を維持）
    widget.NewLabel("⏰ 最終: 15:04:05 | 次回: 15:05:05 | 稼働: 2h"),
))
```

**改善内容:**
- カード形式での囲い
- システム状態行を太字表示
- **情報内容は一切変更なし**

### 2. ログ表示改善

#### 現在の実装維持
```go
// 既存のRichTextログ表示をそのまま使用
app.logText = widget.NewRichTextFromMarkdown("**Logs will appear here...**")
logCard := widget.NewCard("処理ログ", "", logScroll)
```

**改善内容:**
- カードタイトル追加のみ
- **ログ内容・表示形式は一切変更なし**

### 3. ボタンパネル改善

#### 現在のボタン機能を完全維持
```go
// 既存ボタンにアイコンを追加するのみ
buttons := []struct{
    icon string
    text string
    importance widget.Importance
}{
    {"⚙️", msg.ConfigCmd, widget.MediumImportance},
    {"📋", msg.LogsCmd, widget.LowImportance},
    {"🔍", msg.ScanCmd, widget.HighImportance},
    {"📁", msg.InputDirCmd, widget.LowImportance},
    {"📁", msg.OutputDirCmd, widget.LowImportance},
    {"🎤", msg.RecordCmd, widget.MediumImportance},  // 録音機能維持
    {"❌", msg.QuitCmd, widget.DangerImportance},
}
```

**改善内容:**
- ボタンにアイコン追加
- **機能・配置は一切変更なし**

## 技術実装

### レイアウト構造（変更なし）
```go
// 既存のBorderLayout構造を完全維持
content := container.NewBorder(
    statusCard,    // top - ステータスパネル
    buttonPanel,   // bottom - ボタンパネル
    nil,          // left
    nil,          // right
    logCard,      // center - ログ表示
)
```

### 更新システム（変更なし）
- 既存の5秒間隔更新を維持
- 既存の`updateUI()`ロジックを変更なし
- 既存のログバッファ管理を維持

### 設定システム（変更なし）
- 既存の設定ダイアログを完全維持
- 既存の多言語対応を維持
- 新しい設定項目は追加しない


## 実装計画

### Phase 1: 視覚改善のみ
1. **ステータスパネル**をカード形式に変更
2. **ログ表示**をカード形式に変更
3. **ボタン**にアイコン追加
4. **既存機能の動作確認**

### 実装ファイル
- `internal/gui/components.go` - 軽微な修正のみ
- `internal/gui/window.go` - レイアウト調整のみ

### 変更しないファイル
- `internal/gui/app.go` - 更新ロジック維持
- `internal/gui/dialogs.go` - 設定機能維持
- すべての`internal/`パッケージ - 完全維持

## 期待効果

### 改善される点
- **視認性向上**: カード形式による情報の整理
- **操作性向上**: アイコン付きボタンによる直感性
- **統一感**: 全体的なデザイン統一

### 維持される点
- **既存のすべての機能**
- **既存の操作方法**
- **既存の設定・多言語対応**
- **既存の安定性**

## 品質保証

### リスク最小化
- 既存ロジックの変更なし
- 新規コンポーネント最小限
- 段階的実装による安全性確保

### テスト方針
- 既存機能の動作確認のみ
- 新機能テストは不要（追加機能なしのため）

---

この設計により、既存の優れたTUI構造を活かしつつ、安全で実用的な視覚改善を実現します。

## 補足: 初期GUI設計からの発展

### 初期設計（v1.3.0）
初期のGUI実装では以下の設計方針で開発されました：

#### 基本原則
- **機能互換性**: 既存TUIと完全に同じ機能を提供
- **シンプル設計**: 必要最小限の実装で直感的なUI
- **既存コード活用**: processor/logger/whisper/configパッケージはそのまま使用

#### 終了仕様
- **即座終了**: ウィンドウクローズ、終了ボタンで即座にアプリケーション終了
- **クリーンアップなし**: グレースフルシャットダウンは実装しない
- **実用性重視**: 処理中でも強制終了（ユーザーが終了したい時は処理中が多いため）

#### UI更新方式
- **定期更新**: 5秒間隔でUI全体を更新
- **シンプル実装**: イベント駆動ではなく定期ポーリング
- **軽量化**: ログは12エントリ制限を維持

#### パッケージ構成
```
internal/gui/
├── app.go          # GUI アプリケーション本体
├── window.go       # ウィンドウレイアウト
├── components.go   # UI コンポーネント（ステータス、ログ、ボタン）
└── icons/
    ├── icon.go     # アイコンリソース
    └── icon.png    # アプリケーションアイコン
```

#### 起動方式
```bash
# GUI モード起動
./koemoji-go --gui

# 従来通りTUI起動（デフォルト）
./koemoji-go
```

#### ウィンドウ仕様
- **サイズ**: 800x700 ピクセル
- **レイアウト**: BorderLayout（上：ステータス、中央：ログ、下：ボタン）
- **起動位置**: 画面中央
- **リサイズ**: 可能

#### コンポーネント設計

**ステータスパネル（上部）**:
```
🟢 稼働中 | 待機: 0 | 処理中: なし
📁 入力: 2 → 出力: 5 → アーカイブ: 10  
⏰ 最終: 15:04:05 | 次回: 15:05:05 | 稼働: 2h
```

**ログビューア（中央）**:
- スクロール可能なログ表示
- 12エントリの循環表示（TUIと同じ）
- フォーマット: `[レベル] 時刻 メッセージ`

**ボタンパネル（下部）**:
```
[設定] [ログ] [スキャン] [入力] [出力] [録音] [終了]
```

#### 技術仕様
- **フレームワーク**: Fyne v2
- **バイナリサイズ**: GUI版は+30-40MB（Fyne込み）
- **メモリ使用**: GUI版は+30-40MB

### 現在の視覚改善設計（v1.4.1+）
初期設計をベースに、情報構造を保持しつつ視覚的な改善のみを行う方針に発展。

#### 改善の焦点
- 既存の優れた3層構造（ステータス・ログ・ボタン）を完全維持
- カード形式による視認性向上
- アイコン付きボタンによる操作性改善
- **情報内容の変更は一切なし**

この発展により、機能性を保持しつつ、より使いやすいGUIインターフェースを提供しています。