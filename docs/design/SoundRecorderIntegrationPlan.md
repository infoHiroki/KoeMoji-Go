# KoeMoji-Go 録音機能統合設計書

## プロジェクト概要

KoeMoji-Goへの録音機能統合により、録音→文字起こし→AI要約の完全なワークフローを実現する。

## 設計タスク一覧

### ✅ 完了済み

- [x] **基本分析**: SoundRecorderDesign.mdの要件分析完了
- [x] **アーキテクチャ調査**: 既存KoeMoji-Go構造の把握完了  
- [x] **統合計画**: 基本的な統合戦略の策定完了
- [x] **TUI統合**: 録音機能のTUI統合完了（v1.4.0）
- [x] **設定統合**: 設定画面でのデバイス選択機能完了
- [x] **UI実装**: rキーでの録音開始/停止、リアルタイム表示完了
- [x] **ワークフロー統合**: 録音→保存→文字起こしの自動化完了

## 実装結果（v1.4.0）

### アーキテクチャ統合
- **Config構造体**: `RecordingDeviceID`、`RecordingDeviceName`を追加
- **Messages構造体**: 録音関連メッセージの日英対応完了
- **App構造体**: 録音状態管理フィールド追加（`recorder`、`isRecording`、`recordingStartTime`）

### UI統合
- **rキー**: 録音開始/停止のトグル機能実装
- **録音表示**: 🔴録音中 - 時間のリアルタイム表示
- **設定画面**: 項目18で録音デバイス選択機能
- **コマンド一覧**: rコマンドを追加表示

### ワークフロー
- **ファイル命名**: `recording_YYYYMMDD_HHMM.wav`形式
- **自動保存**: `input/`ディレクトリに直接保存
- **自動処理**: 次回スキャンで文字起こし対象に自動追加

### エラーハンドリング
- **初期化失敗**: PortAudio初期化エラー時の適切な処理
- **デバイスエラー**: 分かりやすいエラーメッセージ表示
- **権限エラー**: macOSマイク権限の考慮

## 技術仕様

### 音声仕様
- **形式**: WAV
- **サンプリングレート**: 44.1kHz
- **ビット深度**: 16bit
- **チャンネル**: モノラル
- **バッファサイズ**: 4096フレーム

### 対応デバイス
- **既定デバイス**: ID -1で自動選択
- **仮想デバイス**: BlackHole（macOS）、Stereo Mix（Windows）
- **システム音声**: 仮想デバイス経由で録音可能

## 設計原則

### 1. 既存システムとの調和
- 既存のアーキテクチャパターンを踏襲
- 設定管理の一貫性維持
- ログシステムの統一

### 2. ユーザビリティ
- 直感的な操作性（TUI/GUI両対応）
- 分かりやすいステータス表示
- エラー時の適切なガイダンス

### 3. 技術的安定性
- スレッドセーフな実装
- 適切なリソース管理
- プラットフォーム間の動作一貫性

### 4. 拡張性
- 将来的な機能追加への対応
- 設定項目の柔軟な拡張
- 新しい音声フォーマット対応

## プロジェクト完了

KoeMoji-Goへの録音機能統合が正常に完了しました。

### 達成された目標
- ✅ シンプルで直感的な録音操作（rキー）
- ✅ リアルタイムの録音状態表示
- ✅ 既存ワークフローとの完全統合
- ✅ クロスプラットフォーム対応
- ✅ エラーハンドリングの充実

---

*最終更新: 2025-06-21*
*ステータス: 実装完了（v1.4.0）*