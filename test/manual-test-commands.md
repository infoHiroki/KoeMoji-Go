# KoeMoji-Go 手動テストコマンド

## 事前準備

### 1. ビルド
```bash
cd /Users/hirokitakamura/Documents/Dev/KoeMoji-Go
go build -o koemoji-go ./cmd/koemoji-go
```

### 2. 必要ディレクトリの作成
```bash
mkdir -p input output archive
```

### 3. 設定ファイルの確認
```bash
ls -la config.json
# 存在しない場合は初回起動時に作成される
```

## KISS設計修正の検証テスト

### テスト1: 基本動作確認

#### 1.1 バージョンとヘルプ
```bash
./koemoji-go --version
./koemoji-go --help
```

#### 1.2 GUI起動テスト
```bash
./koemoji-go --gui
```
**期待結果**: GUIが正常に起動し、エラーが出ない

### テスト2: 録音機能の状態管理テスト

#### 2.1 録音開始・停止テスト
```bash
# GUIモードで起動
./koemoji-go --gui
```

**手動操作手順**:
1. 録音ボタンをクリック → 「録音」から「停止」に変化
2. 数秒待機 → タイミング表示に録音時間が表示される
3. 停止ボタンをクリック → 「停止」から「録音」に戻る
4. `input/`ディレクトリに`recording_YYYYMMDD_HHMM.wav`が作成される

**期待結果**: 
- ボタンの表示が正確に切り替わる
- 録音時間が正確に表示される
- 録音ファイルが正常に保存される

#### 2.2 設定ダイアログでの録音デバイス確認
```bash
# GUIモードで起動後
# 設定ボタン → Recordingタブ
```

**期待結果**: 利用可能な録音デバイスが表示される

### テスト3: 録音中終了警告テスト（重要）

#### 3.1 ウィンドウクローズ時の警告テスト
```bash
./koemoji-go --gui
```

**手動操作手順**:
1. 録音ボタンをクリックして録音開始
2. 録音中にウィンドウの×ボタンをクリック
3. 警告ダイアログが表示されることを確認
4. 「キャンセル」をクリック → アプリが継続
5. 再度×ボタンをクリック → 「OK」をクリック → アプリが終了

**期待結果**: 
- ✅ 録音中の終了で警告ダイアログが表示される
- ✅ キャンセル時はアプリが継続する
- ✅ 確認時はアプリが終了する

#### 3.2 終了ボタンでの警告テスト
```bash
./koemoji-go --gui
```

**手動操作手順**:
1. 録音ボタンをクリックして録音開始
2. 録音中に「Quit」ボタンをクリック
3. 同様の警告ダイアログが表示されることを確認

### テスト4: 状態同期の一貫性テスト

#### 4.1 録音状態の一貫性確認
```bash
./koemoji-go --gui
```

**確認ポイント**:
1. 録音開始時：
   - ボタンテキストが「停止」に変更
   - タイミング表示に録音時間が表示
   - 全ての表示が同期している

2. 録音停止時：
   - ボタンテキストが「録音」に戻る
   - 録音時間表示が消える
   - ログに録音完了メッセージが表示

**期待結果**: すべての表示が一貫して同期している

### テスト5: エラーケースのテスト

#### 5.1 録音デバイスなし環境のテスト
```bash
# 録音デバイスを無効にしてテスト（環境依存）
./koemoji-go --gui
```

#### 5.2 入力ディレクトリ権限エラーのテスト
```bash
# 権限を変更してテスト
chmod 000 input
./koemoji-go --gui
# テスト後復旧
chmod 755 input
```

## パフォーマンステスト

### テスト6: リソース使用量確認

#### 6.1 メモリ使用量モニタリング
```bash
# GUIモードで起動
./koemoji-go --gui &

# メモリ使用量確認（macOS）
ps aux | grep koemoji-go

# または Activity Monitor で確認
```

#### 6.2 長時間録音テスト
```bash
./koemoji-go --gui
```

**手動操作**:
1. 5分間の録音を実行
2. メモリリークがないか確認
3. UI応答性が維持されているか確認

## TUIモード互換性テスト

### テスト7: TUIモードでの録音機能

#### 7.1 TUIモードでの録音
```bash
./koemoji-go
```

**キーボード操作**:
1. `r` キーを押して録音開始
2. 再度 `r` キーを押して録音停止
3. `q` キーで終了

### テスト8: 既存機能の回帰テスト

#### 8.1 設定機能
```bash
./koemoji-go --configure
# または
./koemoji-go
# 起動後 'c' キー
```

#### 8.2 ファイル処理テスト
```bash
# テスト用音声ファイルを input/ に配置
cp /path/to/test.wav input/
./koemoji-go --gui
# または
./koemoji-go
```

## トラブルシューティング用コマンド

### デバッグモード
```bash
./koemoji-go --debug --gui
```

### ログファイル確認
```bash
# ログファイルの場所確認
ls -la *.log

# ログ内容確認
tail -f koemoji-go.log
```

### 設定ファイル確認
```bash
cat config.json | jq .
# またはJSONビューアーで確認
```

### プロセス確認
```bash
# 実行中のプロセス確認
ps aux | grep koemoji-go

# ポート使用確認（該当する場合）
lsof -i -P | grep koemoji-go
```

## 成功基準

### 必須要件（修正内容の検証）
- ✅ **録音中終了警告が表示される**
- ✅ **状態表示が一貫している**
- ✅ **録音機能が正常動作する**
- ✅ **メモリリークがない**

### 回帰テスト
- ✅ 既存のファイル処理機能が動作する
- ✅ 設定変更が正常に保存される
- ✅ TUIモードが正常動作する

## 実行例

```bash
# 完全なテストシーケンス例
cd /Users/hirokitakamura/Documents/Dev/KoeMoji-Go

# ビルド
go build -o koemoji-go ./cmd/koemoji-go

# 基本動作確認
./koemoji-go --version
./koemoji-go --help

# 重要：録音中終了警告のテスト
./koemoji-go --gui
# 1. 録音開始
# 2. ウィンドウ×ボタンクリック
# 3. 警告ダイアログ確認 ← 最重要
# 4. キャンセル・確認の動作確認

# 成功なら完了
echo "KISS設計による修正が成功しました！"
```